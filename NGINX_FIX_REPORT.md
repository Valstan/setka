# üîß –û—Ç—á—ë—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

**–î–∞—Ç–∞:** 18 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üîç –ü–†–û–ë–õ–ï–ú–ê

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∞–π—Ç –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ HTTPS. –ü—Ä–∏—á–∏–Ω–∞:
- –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `/etc/nginx/conf.d/setka.conf` —Å–æ–¥–µ—Ä–∂–∞–ª–∞ —Ç–æ–ª—å–∫–æ HTTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—ã–ª–∞ –≤ –±—ç–∫–∞–ø–µ `setka.conf.ssl-backup`
- –ü–æ—Ä—Ç 443 –Ω–µ —Å–ª—É—à–∞–ª—Å—è

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–µ–π—Å—Ç–≤–∏—è:**
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª –∏–∑ –±—ç–∫–∞–ø–∞ `setka.conf.ssl-backup`
- –î–æ–±–∞–≤–ª–µ–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è:
  - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç HTTP ‚Üí HTTPS (301)
  - Security headers
  - –£–ª—É—á—à–µ–Ω–Ω—ã–µ timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket

### 2. –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `/etc/nginx/conf.d/setka.conf`

**–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏:**

#### HTTPS —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 443):
```nginx
server {
    server_name 3931b3fe50ab.vps.myjino.ru;
    listen 443 ssl;
    
    ssl_certificate /etc/letsencrypt/live/3931b3fe50ab.vps.myjino.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/3931b3fe50ab.vps.myjino.ru/privkey.pem;
    
    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ FastAPI
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header X-Forwarded-Proto https;
    }
}
```

#### HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç (–ø–æ—Ä—Ç 80):
```nginx
server {
    listen 80;
    server_name 3931b3fe50ab.vps.myjino.ru;
    
    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
    location / {
        return 301 https://$host$request_uri;
    }
}
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå HTTPS –Ω–µ —Ä–∞–±–æ—Ç–∞–ª (–ø–æ—Ä—Ç 443 –Ω–µ —Å–ª—É—à–∞–ª—Å—è)
- ‚ùå HTTP –≤–æ–∑–≤—Ä–∞—â–∞–ª 404
- ‚ùå –°–∞–π—Ç –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Ä—Ç 443 —Å–ª—É—à–∞–µ—Ç—Å—è)
- ‚úÖ HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ HTTPS (301)
- ‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –æ–±–æ–∏–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

## üß™ –ü–†–û–í–ï–†–ö–ê

### –¢–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```bash
# HTTPS
curl https://3931b3fe50ab.vps.myjino.ru/api/health/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"status":"healthy","service":"SETKA"}

# HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç)
curl -I http://3931b3fe50ab.vps.myjino.ru/api/health/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: HTTP/1.1 301 Moved Permanently
# Location: https://3931b3fe50ab.vps.myjino.ru/api/health/
```

### –°—Ç–∞—Ç—É—Å –ø–æ—Ä—Ç–æ–≤:
```
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      nginx
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      nginx
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      python3 (FastAPI)
```

---

## üìÅ –ë–≠–ö–ê–ü–´

–°–æ–∑–¥–∞–Ω—ã –±—ç–∫–∞–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:
- `/etc/nginx/conf.d/setka.conf.http-only-backup` - —Å—Ç–∞—Ä–∞—è HTTP-only –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `/etc/nginx/conf.d/setka.conf.ssl-backup` - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `/etc/nginx/conf.d/setka.conf.backup` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±—ç–∫–∞–ø

---

## ‚úÖ –ò–¢–û–ì–ò

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:**
- ‚úÖ HTTPS –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ HTTP –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ HTTPS
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `nginx -t` –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 18 –¥–µ–∫–∞–±—Ä—è 2025*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢*


